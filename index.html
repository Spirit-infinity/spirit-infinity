<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>SPIRIT INFINITY | Live Partner Ledger</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --orange: #ff4500; --bg: #0a0a0a; --card: #141414; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'Orbitron', sans-serif; padding: 40px; margin: 0; }
        .header { border-bottom: 2px solid var(--orange); padding-bottom: 20px; margin-bottom: 40px; }
        h1 { color: #fff; margin: 0; text-transform: uppercase; letter-spacing: 3px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .card { background: var(--card); border: 1px solid #333; padding: 30px; border-radius: 8px; box-shadow: 10px 10px 20px rgba(0,0,0,0.5); border-left: 5px solid var(--orange); }
        .label { color: #888; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 10px; }
        .value { font-size: 3rem; color: var(--orange); font-weight: bold; }
        .unit { font-size: 1.2rem; color: #fff; margin-left: 10px; }
        .status { margin-top: 40px; font-size: 0.7rem; color: #00ff00; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="header">
        <h1>SPIRIT INFINITY <span style="font-weight:100; font-size: 0.5em;">| PARTNER CONNECT</span></h1>
        <div class="status">● Connexion Ledger Temps Réel Établie</div>
    </div>

    <div class="grid">
        <div class="card">
            <div class="label">Total Royalties (Invention)</div>
            <div id="royalty-val" class="value">0.00<span class="unit">€</span></div>
        </div>
        <div class="card">
            <div class="label">Partner Share (Marketplace 2.5%)</div>
            <div id="partner-val" class="value">0.00<span class="unit">€</span></div>
        </div>
        <div class="card">
            <div class="label">Ma Commission (Marketplace 2.5%)</div>
            <div id="spirit-val" class="value">0.00<span class="unit">€</span></div>
        </div>
    </div>

    <script>
        // Ta configuration sécurisée
        const SUPABASE_URL = 'https://mkgskobkcpslnyyidmvo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'; // Ta clé complète
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function updateDashboard() {
            let { data: trans, error } = await _supabase.from('transactions').select('*');
            
            if (error) { console.error(error); return; }

            let totalR = trans.reduce((sum, t) => sum + (Number(t.spirit_royalty) || 0), 0);
            let totalP = trans.reduce((sum, t) => sum + (Number(t.commission_partner_2_5_percent) || 0), 0);
            let totalS = trans.reduce((sum, t) => sum + (Number(t.commission_spirit_2_5_percent) || 0), 0);

            document.getElementById('royalty-val').innerHTML = totalR.toFixed(2) + '<span class="unit">€</span>';
            document.getElementById('partner-val').innerHTML = totalP.toFixed(2) + '<span class="unit">€</span>';
            document.getElementById('spirit-val').innerHTML = totalS.toFixed(2) + '<span class="unit">€</span>';
        }

        // Mise à jour automatique toutes les 2 secondes (Effet Live)
        setInterval(updateDashboard, 2000);
        updateDashboard();
    </script>
</body>
</html>
