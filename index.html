<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Spirit Infinity | Liaison Finale</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #050505; color: white; font-family: 'Inter', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .panel { border: 2px solid #ff6600; background: #0a0a0a; padding: 40px; width: 450px; text-align: center; box-shadow: 0 0 40px rgba(255, 102, 0, 0.2); }
        .status-box { background: #000; border: 1px solid #222; padding: 20px; margin: 25px 0; font-family: monospace; font-size: 0.8rem; text-align: left; min-height: 80px; line-height: 1.5; }
        button { background: #ff6600; color: black; border: none; padding: 20px; width: 100%; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }
        button:hover { background: #00ffaa; color: #000; }
        .success { color: #00ffaa; }
        .error { color: #ff3333; }
    </style>
</head>
<body>

<div class="panel">
    <h1 style="margin:0; font-size: 1.5rem; letter-spacing: 3px;">SPIRIT INFINITY</h1>
    <p style="color: #666; font-size: 0.7rem; margin-top: 5px;">DOSSIER PARTENAIRE : LIAISON SÉCURISÉE</p>
    
    <div class="status-box" id="term">> Prêt pour le test final...</div>
    
    <button onclick="spiritSync()">FORCER LA SYNCHRONISATION</button>
</div>

<script>
    // (c) 2026 Spirit Infinity - Tous droits réservés

    // CONFIGURATION NETTOYÉE (ZÉRO ESPACE)
    const SUPA_URL = 'https://eagmxrbtcajqlhivvpww.supabase.co';
    const SUPA_KEY = 'EyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhZ214cmJ0Y2FqcWxoaXZ2cHd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMDYzMTAsImV4cCI6MjA4Njg4MjMxMH0.bkruo7GrA7UUZIv7HANG4_DFUrm9IygJP9ueVk_4r78';

    async function spiritSync() {
        const out = document.getElementById('term');
        out.innerHTML = "> Initialisation...<br>> Envoi des données Ledger...";
        out.style.color = "white";

        try {
            // Création du client sans variables globales pour éviter les conflits
            const _spirit = supabase.createClient(SUPA_URL, SUPA_KEY.trim());

            const { data, error } = await _spirit
                .from('transactions')
                .insert([{ 
                    price_sold: 100, 
                    spirit_royalty: 3.00, 
                    commission_partner_2_5_percent: 2.50, 
                    commission_spirit_2_5_percent: 2.50,
                    status: 'VALIDÉ_FINAL'
                }])
                .select();

            if (error) {
                // Si l'erreur persiste, cela signifie que la clé a expiré ou a été modifiée dans Supabase
                out.innerHTML = "<span class='error'>> ÉCHEC : " + error.message + "</span><br>> Vérifie que la clé 'anon/public' est la même sur ton Dashboard.";
            } else {
                out.innerHTML = "<span class='success'>> SUCCÈS : 100€ ajoutés au Ledger !<br>> Liaison Spirit Infinity 100% OK.</span>";
                console.log("Données :", data);
            }
        } catch (err) {
            out.innerHTML = "<span class='error'>> ERREUR CRITIQUE : " + err.message + "</span>";
        }
    }
</script>
</body>
</html>
